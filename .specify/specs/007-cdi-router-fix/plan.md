# 実装計画: CDI Router 変換の修正

## 概要
この計画は、`MappingEngine` 内の Router 変換の不完全な実装を修正します。既存の実装はルーティングされた行を計算しますが、`defaultGroup` の行のみをダウンストリームの変換に渡しており、異なるブランチに異なるサブセットをルーティングしていません。

## 目標
1. **データモデルの強化**: `MappingLink` を拡張して router グループの指定をサポート。
2. **エンジンロジックの更新**: `traverseAsync` を修正してリンク構成に基づいて正しいデータサブセットをルーティング。
3. **検証**: Router 機能のための包括的なユニットテストを作成。

## 実装詳細

### フェーズ 1: データモデルの更新
- `MappingTypes.ts` の `MappingLink` インターフェースに `routerGroup?: string` プロパティを追加。
- これにより、リンクが Router のどの出力グループに接続するかを指定可能に。

### フェーズ 2: エンジンロジックの強化
- `MappingEngine.ts` の `traverseAsync` を更新：
  - 現在のノードが Router かどうかを検出。
  - 送信リンクを反復する際に `link.routerGroup` を確認。
  - 各ダウンストリームノードに正しいデータサブセットを渡す。

### フェーズ 3: 検証
- `MappingEngine_Router.test.ts` を作成して以下を検証：
  - データが正しく複数のグループに分割される。
  - ダウンストリームノードがリンク構成に基づいて正しいサブセットを受け取る。
  - デフォルトグループがマッチしない行を受け取る。

## リスクと軽減策
- **リスク**: `routerGroup` を使用しない既存のマッピングを壊す可能性。
    - **軽減**: デフォルトの動作は `routerGroup` が指定されていない場合に `defaultGroup` にフォールバック。
