---
name: speckit-specify
description: 自然言語の機能説明から、機能仕様書（Feature Specification）を作成または更新します。
---

## ユーザー入力

```text
$ARGUMENTS
```

ユーザー入力がある場合、処理を進める前に**必ず**考慮してください。

## 概要

トリガーメッセージ内の `/speckit.specify` の後にユーザーが入力したテキストが、機能説明（Feature Description）となります。`$ARGUMENTS` が以下にリテラルとして表示されても、常に会話内でその説明が利用可能であると仮定してください。空のコマンドでない限り、ユーザーに繰り返しを求めないでください。

その機能説明に基づいて、以下を実行します：

### 1. 簡潔なショートネームの生成

ブランチ用に2〜4語のショートネームを生成します：
- 機能説明を分析し、最も意味のあるキーワードを抽出
- 機能の本質を捉えた2〜4語のショートネームを作成
- 可能な限り「動詞-名詞」形式を使用（例：`add-user-auth`, `fix-payment-bug`）
- 技術用語や頭字語（OAuth2, API, JWTなど）は保持
- 機能を一目で理解できる程度に簡潔かつ説明的にする

### 2. 新しいブランチを作成する前の既存チェック

a. まず、最新情報を確実にするためにすべてのリモートブランチをフェッチします：

   ```bash
   git fetch --all --prune
   ```

b. ショートネームに対応する最大の機能番号をすべてのソースから検索します：
   - リモートブランチ: `git ls-remote --heads origin | grep -E 'refs/heads/[0-9]+-<short-name>$'`
   - ローカルブランチ: `git branch | grep -E '^[* ]*[0-9]+-<short-name>$'`
   - Specsディレクトリ: `specs/[0-9]+-<short-name>` に一致するディレクトリを確認

c. 次に利用可能な番号を決定します：
   - 3つのソースすべてから番号を抽出
   - 最大の番号 N を見つける
   - 新しいブランチ番号には N+1 を使用

d. 計算された番号とショートネームを使用してスクリプト `.specify/scripts/bash/create-new-feature.sh --json "$ARGUMENTS"` を実行します：
   - `--number N+1` と `--short-name "your-short-name"` を機能説明とともに渡す

**重要**:
- 3つのソース（リモートブランチ、ローカルブランチ、specsディレクトリ）すべてを確認して最大の番号を見つけてください
- 正確なショートネームパターンを持つブランチ/ディレクトリのみを一致させてください
- このショートネームを持つ既存のブランチ/ディレクトリが見つからない場合は、番号 1 から開始してください
- JSON出力には `BRANCH_NAME` と `SPEC_FILE` パスが含まれます
- 引数内のシングルクォートについては、エスケープ構文を使用してください

### 3. スペックテンプレートの読み込み

必要なセクションを理解するために `.specify/templates/spec-template.md` を読み込みます。

### 4. 実行フロー

1. **入力からのユーザー説明の解析**
   空の場合: エラー "機能説明が提供されていません"
2. **説明からの主要概念の抽出**
   特定: アクター、アクション、データ、制約
3. **不明確な側面について**:
   - コンテキストと業界標準に基づいて情報に基づいた推測を行う
   - 以下の条件の場合のみ `[NEEDS CLARIFICATION: 具体的な質問]` でマークする：
     - 選択が機能スコープやユーザーエクスペリエンスに大きく影響する場合
     - 異なる意味を持つ複数の妥当な解釈が存在する場合
     - 合理的なデフォルトが存在しない場合
   - **制限: 合計で最大3つの [NEEDS CLARIFICATION] マーカーまで**
4. **ユーザーシナリオとテストセクションの記入**
   明確なユーザーフローがない場合: エラー "ユーザーシナリオを決定できません"
5. **機能要件の生成**
   各要件はテスト可能である必要があります
6. **成功基準の定義**
   測定可能で、技術に依存しない成果を作成
7. **主要エンティティの特定** (データが関与する場合)
8. **戻り値**: SUCCESS (計画の準備完了)

### 5. スペックの書き込み

テンプレート構造を使用して `SPEC_FILE` に仕様を書き込みます。

### 6. 仕様品質検証

書き込み後、品質基準に対して検証します。

### 7. 完了報告

ブランチ名、スペックファイルパス、チェックリスト結果を報告します。

## 一般ガイドライン

- **WHAT**（ユーザーが何を必要としているか）と **WHY**（なぜ必要か）に焦点を当ててください。
- HOW（実装方法、技術スタック、API、コード構造）は避けてください。
- 開発者ではなく、ビジネスステークホルダー向けに記述してください。
- スペック内に埋め込まれたチェックリストは作成しないでください。

### セクション要件

- **必須セクション**: すべての機能で完了する必要があります
- **オプションセクション**: 機能に関連する場合のみ含めます
- セクションが適用されない場合は、完全に削除してください（"N/A" として残さないでください）

### 成功基準ガイドライン

成功基準は以下である必要があります：

1. **測定可能 (Measurability)**: 具体的な指標（時間、パーセンテージ、数、率）を含める
2. **技術非依存 (Technology-agnostic)**: フレームワーク、言語、データベース、ツールの言及なし
3. **ユーザー重視 (User-focused)**: ユーザー/ビジネスの視点から成果を記述
4. **検証可能 (Verifiable)**: 実装の詳細を知らなくてもテスト/検証可能であること
