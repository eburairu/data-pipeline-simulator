---
name: speckit-tasks
description: 利用可能な設計アーティファクトに基づいて、機能のための依存関係順のアクション可能な tasks.md を生成します。
---

## ユーザー入力

```text
$ARGUMENTS
```

ユーザー入力がある場合、処理を進める前に**必ず**考慮してください。

## 概要

### 1. セットアップ

リポジトリルートから `.specify/scripts/bash/check-prerequisites.sh --json` を実行し、`FEATURE_DIR` と `AVAILABLE_DOCS` リストを解析します。すべてのパスは絶対パスである必要があります。引数内のシングルクォートについては、エスケープ構文を使用してください。

### 2. 設計ドキュメントの読み込み

`FEATURE_DIR` から読み込みます：
- **必須**: plan.md (技術スタック、ライブラリ、構造), spec.md (優先順位付きユーザーストーリー)
- **オプション**: data-model.md (エンティティ), contracts/ (APIエンドポイント), research.md (決定事項), quickstart.md (テストシナリオ)
- 注: すべてのプロジェクトですべてのドキュメントがあるわけではありません。利用可能なものに基づいてタスクを生成します。

### 3. タスク生成ワークフローの実行

- plan.md を読み込み、技術スタック、ライブラリ、プロジェクト構造を抽出
- spec.md を読み込み、優先順位（P1, P2, P3...）付きのユーザーストーリーを抽出
- data-model.md が存在する場合: エンティティを抽出してユーザーストーリーにマッピング
- contracts/ が存在する場合: エンドポイントをユーザーストーリーにマッピング
- research.md が存在する場合: セットアップタスクのための決定事項を抽出
- ユーザーストーリーごとに整理されたタスクを生成（以下のタスク生成ルールを参照）
- ユーザーストーリーの完了順序を示す依存関係グラフを生成
- ユーザーストーリーごとの並行実行例を作成
- タスクの完全性を検証（各ストーリーに必要な全タスクがあり、独立してテスト可能か）

### 4. tasks.md の生成

`.specify/templates/tasks-template.md` を構造として使用し、以下を埋めます：
- plan.md からの正確な機能名
- フェーズ 1: セットアップタスク（プロジェクト初期化）
- フェーズ 2: 基盤タスク（すべてのユーザーストーリーのブロッキング前提条件）
- フェーズ 3以降: 1フェーズにつき1ユーザーストーリー（spec.md の優先順位順）
- 各フェーズの内容: ストーリー目標、独立したテスト基準、テスト（要求された場合）、実装タスク
- 最終フェーズ: 仕上げと横断的な関心事
- すべてのタスクは厳格なチェックリスト形式に従う必要があります（以下のタスク生成ルールを参照）
- 各タスクに明確なファイルパス
- ストーリー完了順序を示す依存関係セクション
- ストーリーごとの並行実行例
- 実装戦略セクション（MVP優先、増分デリバリー）

### 5. 報告

生成された `tasks.md` のパスとサマリーを出力します。

タスク生成のためのコンテキスト: $ARGUMENTS

## タスク生成ルール

**重要**: タスクは、独立した実装とテストを可能にするために、ユーザーストーリーごとに整理しなければなりません。

**テストはオプションです**: 明示的に要求された場合のみ、テストタスクを生成してください。

### チェックリスト形式 (必須)

すべてのタスクは以下の形式に厳密に従わなければなりません：

```text
- [ ] [TaskID] [P?] [Story?] ファイルパスを含む説明
```

**フォーマットコンポーネント**:

1. **チェックボックス**: 常に `- [ ]` (markdown checkbox) で開始
2. **Task ID**: 実行順の連番 (T001, T002, T003...)
3. **[P] マーカー**: タスクが並行実行可能な場合のみ含める
4. **[Story] ラベル**: ユーザーストーリーフェーズのタスクにのみ必須
   - 形式: [US1], [US2], [US3] など
   - Setup フェーズ: ストーリーラベルなし
   - Foundational フェーズ: ストーリーラベルなし
   - User Story フェーズ: ストーリーラベル必須
   - Polish フェーズ: ストーリーラベルなし
5. **説明**: 正確なファイルパスを含む明確なアクション

**例**:

- ✅ 正解: `- [ ] T001 実装計画に従ってプロジェクト構造を作成`
- ✅ 正解: `- [ ] T005 [P] src/middleware/auth.py に認証ミドルウェアを実装`
- ✅ 正解: `- [ ] T012 [P] [US1] src/models/user.py に User モデルを作成`
- ❌ 間違い: `- [ ] User モデルを作成` (IDとストーリーラベル欠落)
- ❌ 間違い: `T001 [US1] モデルを作成` (チェックボックス欠落)

### フェーズ構造

- **Phase 1**: セットアップ (プロジェクト初期化)
- **Phase 2**: 基盤 (ブロッキング前提条件 - ユーザーストーリーの前に完了必須)
- **Phase 3+**: 優先順位順のユーザーストーリー (P1, P2, P3...)
  - 各ストーリー内: テスト(要求あれば) → モデル → サービス → エンドポイント → 統合
  - 各フェーズは、完全で独立してテスト可能な増分であるべき
- **Final Phase**: 仕上げと横断的な関心事
